{"version":3,"file":"flash-message.js","sources":["../../src/components/flash-message.gts"],"sourcesContent":["import Component from '@glimmer/component';\nimport { tracked } from '@glimmer/tracking';\nimport { htmlSafe } from '@ember/template';\nimport { next, cancel } from '@ember/runloop';\nimport { on } from '@ember/modifier';\nimport { modifier } from 'ember-modifier';\n\nimport type { Timer } from '@ember/runloop';\nimport type FlashObject from '../flash/object.ts';\n\n// FlashObject with custom properties from T accessible in yielded block\ntype FlashWithCustomProps<T extends Record<string, unknown>> = FlashObject<T> &\n  T;\n\nexport interface FlashMessageSignature<\n  T extends Record<string, unknown> = Record<string, unknown>,\n> {\n  Args: {\n    flash: FlashObject<T>;\n    messageStyle?: 'bootstrap' | 'foundation';\n    messageStylePrefix?: string;\n    exitingClass?: string;\n  };\n  Element: HTMLDivElement;\n  Blocks: {\n    default: [FlashMessage<T>, FlashWithCustomProps<T>, onClose: () => void];\n  };\n}\n\nexport default class FlashMessage<\n  T extends Record<string, unknown> = Record<string, unknown>,\n> extends Component<FlashMessageSignature<T>> {\n  @tracked active = false;\n  @tracked pendingSet: Timer | undefined;\n  @tracked _mouseEnterHandler: ((event?: Event) => void) | undefined;\n  @tracked _mouseLeaveHandler: ((event?: Event) => void) | undefined;\n\n  get messageStyle() {\n    return this.args.messageStyle ?? 'bootstrap';\n  }\n\n  // Expose flash with custom properties typed (for yielding to blocks)\n  get flash(): FlashWithCustomProps<T> {\n    return this.args.flash as FlashWithCustomProps<T>;\n  }\n\n  get showProgress() {\n    return this.args.flash.showProgress;\n  }\n\n  get notExiting() {\n    return !this.exiting;\n  }\n\n  get showProgressBar() {\n    return this.showProgress && this.notExiting;\n  }\n\n  get exiting() {\n    return this.args.flash.exiting;\n  }\n\n  get exitingClass() {\n    return this.args.exitingClass || 'exiting';\n  }\n\n  get messageStylePrefix() {\n    return this.args.messageStylePrefix ?? this._defaultMessageStylePrefix;\n  }\n\n  get _defaultMessageStylePrefix() {\n    const isFoundation = this.messageStyle === 'foundation';\n    return isFoundation ? 'alert-box ' : 'alert alert-';\n  }\n\n  get alertType() {\n    const flashType = this.args.flash.type || '';\n    const prefix = this.messageStylePrefix;\n    return `${prefix}${flashType}`;\n  }\n\n  get flashType() {\n    const type = this.args.flash.type || '';\n    return type.charAt(0).toUpperCase() + type.slice(1);\n  }\n\n  get classNames() {\n    const classes = ['flash-message', this.alertType];\n\n    if (this.exiting) classes.push(this.exitingClass);\n    if (this.active) classes.push('active');\n\n    return classes.join(' ');\n  }\n\n  get progressDuration() {\n    if (!this.args.flash?.showProgress) {\n      return undefined;\n    }\n\n    const duration = this.args.flash?.timeout || 0;\n    return htmlSafe(`transition-duration: ${duration}ms`);\n  }\n\n  #mouseEnter = () => {\n    if (this.args.flash) {\n      this.args.flash.preventExit();\n    }\n  };\n\n  #mouseLeave = () => {\n    if (this.args.flash && !this.args.flash.exiting) {\n      this.args.flash.allowExit();\n    }\n  };\n\n  #destroyFlashMessage() {\n    if (this.args.flash) {\n      this.args.flash.destroyMessage();\n    }\n  }\n\n  onClick = () => {\n    const destroyOnClick = this.args.flash?.destroyOnClick ?? true;\n\n    if (destroyOnClick) {\n      this.#destroyFlashMessage();\n    }\n  };\n\n  onClose = () => {\n    this.#destroyFlashMessage();\n  };\n\n  bindEvents = modifier((element: Element) => {\n    // eslint-disable-next-line ember/no-runloop\n    const pendingSet = next(this, () => {\n      this.active = true;\n    });\n\n    this.pendingSet = pendingSet;\n    this._mouseEnterHandler = this.#mouseEnter;\n    this._mouseLeaveHandler = this.#mouseLeave;\n\n    element.addEventListener(\n      'mouseenter',\n      this._mouseEnterHandler as EventListener,\n    );\n\n    element.addEventListener(\n      'mouseleave',\n      this._mouseLeaveHandler as EventListener,\n    );\n\n    return () => {\n      element.removeEventListener(\n        'mouseenter',\n        this._mouseEnterHandler as EventListener,\n      );\n\n      element.removeEventListener(\n        'mouseleave',\n        this._mouseLeaveHandler as EventListener,\n      );\n\n      // eslint-disable-next-line ember/no-runloop\n      cancel(this.pendingSet);\n\n      this.#destroyFlashMessage();\n    };\n  });\n\n  <template>\n    <div\n      class={{this.classNames}}\n      role=\"alert\"\n      ...attributes\n      {{! template-lint-disable no-invalid-interactive }}\n      {{on \"click\" this.onClick}}\n      {{this.bindEvents}}\n    >\n      {{#if (has-block)}}\n        {{yield this this.flash this.onClose}}\n      {{else}}\n        {{@flash.message}}\n        {{#if this.showProgressBar}}\n          <div class=\"alert-progress\">\n            <div\n              class=\"alert-progress-bar\"\n              style={{this.progressDuration}}\n            ></div>\n          </div>\n        {{/if}}\n      {{/if}}\n    </div>\n  </template>\n}\n"],"names":["FlashMessage","Component","g","prototype","tracked","i","messageStyle","args","flash","showProgress","notExiting","exiting","showProgressBar","exitingClass","messageStylePrefix","_defaultMessageStylePrefix","isFoundation","alertType","flashType","type","prefix","charAt","toUpperCase","slice","classNames","classes","push","active","join","progressDuration","undefined","duration","timeout","htmlSafe","#mouseEnter","preventExit","#mouseLeave","allowExit","#destroyFlashMessage","destroyMessage","onClick","destroyOnClick","onClose","bindEvents","modifier","element","pendingSet","next","_mouseEnterHandler","_mouseLeaveHandler","addEventListener","removeEventListener","cancel","setComponentTemplate","precompileTemplate","strictMode","scope","on"],"mappings":";;;;;;;;;;AA6Be,MAAMA,YAAA,SAEXC,UAAgC;AAAA,EAAA;IAAAC,CAAA,CAAA,IAAA,CAAAC,SAAA,EAAA,QAAA,EAAA,CACvCC,OAAA,CAAA,EAAA,YAAA;AAAA,MAAA,OAAiB,KAAA;AAAA,IAAA,CAAA,CAAA;AAAA;EAAA,OAAA,IAAAC,CAAA,CAAA,IAAA,EAAA,QAAA,CAAA,EAAA,MAAA;AAAA,EAAA;IAAAH,CAAA,CAAA,IAAA,CAAAC,SAAA,EAAA,YAAA,EAAA,CACjBC,OAAA,CAAA,CAAA;AAAA;EAAA,WAAA,IAAAC,CAAA,CAAA,IAAA,EAAA,YAAA,CAAA,EAAA,MAAA;AAAA,EAAA;IAAAH,CAAA,CAAA,IAAA,CAAAC,SAAA,EAAA,oBAAA,EAAA,CACAC,OAAA,CAAA,CAAA;AAAA;EAAA,mBAAA,IAAAC,CAAA,CAAA,IAAA,EAAA,oBAAA,CAAA,EAAA,MAAA;AAAA,EAAA;IAAAH,CAAA,CAAA,IAAA,CAAAC,SAAA,EAAA,oBAAA,EAAA,CACAC,OAAA,CAAA,CAAA;AAAA;EAAA,mBAAA,IAAAC,CAAA,CAAA,IAAA,EAAA,oBAAA,CAAA,EAAA,MAAA;EAED,IAAIC,YAAAA,GAAe;AACjB,IAAA,OAAO,IAAI,CAACC,IAAI,CAACD,YAAY,IAAI,WAAA;AACnC,EAAA;AAEA;EACA,IAAIE,KAAAA,GAAiC;AACnC,IAAA,OAAO,IAAI,CAACD,IAAI,CAACC,KAAK;AACxB,EAAA;EAEA,IAAIC,YAAAA,GAAe;AACjB,IAAA,OAAO,IAAI,CAACF,IAAI,CAACC,KAAK,CAACC,YAAY;AACrC,EAAA;EAEA,IAAIC,UAAAA,GAAa;IACf,OAAO,CAAC,IAAI,CAACC,OAAO;AACtB,EAAA;EAEA,IAAIC,eAAAA,GAAkB;AACpB,IAAA,OAAO,IAAI,CAACH,YAAY,IAAI,IAAI,CAACC,UAAU;AAC7C,EAAA;EAEA,IAAIC,OAAAA,GAAU;AACZ,IAAA,OAAO,IAAI,CAACJ,IAAI,CAACC,KAAK,CAACG,OAAO;AAChC,EAAA;EAEA,IAAIE,YAAAA,GAAe;AACjB,IAAA,OAAO,IAAI,CAACN,IAAI,CAACM,YAAY,IAAI,SAAA;AACnC,EAAA;EAEA,IAAIC,kBAAAA,GAAqB;IACvB,OAAO,IAAI,CAACP,IAAI,CAACO,kBAAkB,IAAI,IAAI,CAACC,0BAA0B;AACxE,EAAA;EAEA,IAAIA,0BAAAA,GAA6B;AAC/B,IAAA,MAAMC,YAAA,GAAe,IAAI,CAACV,YAAY,KAAK,YAAA;AAC3C,IAAA,OAAOU,eAAe,YAAA,GAAe,cAAA;AACvC,EAAA;EAEA,IAAIC,SAAAA,GAAY;IACd,MAAMC,SAAA,GAAY,IAAI,CAACX,IAAI,CAACC,KAAK,CAACW,IAAI,IAAI,EAAA;AAC1C,IAAA,MAAMC,MAAA,GAAS,IAAI,CAACN,kBAAkB;AACtC,IAAA,OAAO,CAAA,EAAGM,MAAA,CAAA,EAASF,WAAW;AAChC,EAAA;EAEA,IAAIA,SAAAA,GAAY;IACd,MAAMC,IAAA,GAAO,IAAI,CAACZ,IAAI,CAACC,KAAK,CAACW,IAAI,IAAI,EAAA;AACrC,IAAA,OAAOA,IAAA,CAAKE,MAAM,CAAC,CAAA,CAAA,CAAGC,WAAW,EAAA,GAAKH,IAAA,CAAKI,KAAK,CAAC,CAAA,CAAA;AACnD,EAAA;EAEA,IAAIC,UAAAA,GAAa;IACf,MAAMC,OAAA,GAAU,CAAC,eAAA,EAAiB,IAAI,CAACR,SAAS,CAAC;IAEjD,IAAI,IAAI,CAACN,OAAO,EAAEc,QAAQC,IAAI,CAAC,IAAI,CAACb,YAAY,CAAA;IAChD,IAAI,IAAI,CAACc,MAAM,EAAEF,OAAA,CAAQC,IAAI,CAAC,QAAA,CAAA;AAE9B,IAAA,OAAOD,OAAA,CAAQG,IAAI,CAAC,GAAA,CAAA;AACtB,EAAA;EAEA,IAAIC,gBAAAA,GAAmB;IACrB,IAAI,CAAC,IAAI,CAACtB,IAAI,CAACC,KAAK,EAAEC,YAAA,EAAc;AAClC,MAAA,OAAOqB,SAAA;AACT,IAAA;IAEA,MAAMC,WAAW,IAAI,CAACxB,IAAI,CAACC,KAAK,EAAEwB,OAAA,IAAW,CAAA;AAC7C,IAAA,OAAOC,SAAS,CAAA,qBAAA,EAAwBF,QAAA,IAAY,CAAA;AACtD,EAAA;EAEA,WAAW,GAAGG,MAAA;AACZ,IAAA,IAAI,IAAI,CAAC3B,IAAI,CAACC,KAAK,EAAE;AACnB,MAAA,IAAI,CAACD,IAAI,CAACC,KAAK,CAAC2B,WAAW,EAAA;AAC7B,IAAA;EACF,CAAA;EAEA,WAAW,GAAGC,MAAA;AACZ,IAAA,IAAI,IAAI,CAAC7B,IAAI,CAACC,KAAK,IAAI,CAAC,IAAI,CAACD,IAAI,CAACC,KAAK,CAACG,OAAO,EAAE;AAC/C,MAAA,IAAI,CAACJ,IAAI,CAACC,KAAK,CAAC6B,SAAS,EAAA;AAC3B,IAAA;EACF,CAAA;EAEA,oBAAoBC,GAAA;AAClB,IAAA,IAAI,IAAI,CAAC/B,IAAI,CAACC,KAAK,EAAE;AACnB,MAAA,IAAI,CAACD,IAAI,CAACC,KAAK,CAAC+B,cAAc,EAAA;AAChC,IAAA;AACF,EAAA;EAEAC,OAAA,GAAUA,MAAA;IACR,MAAMC,iBAAiB,IAAI,CAAClC,IAAI,CAACC,KAAK,EAAEiC,cAAA,IAAkB,IAAA;AAE1D,IAAA,IAAIA,cAAA,EAAgB;AAClB,MAAA,IAAI,CAAC,oBAAoB,EAAA;AAC3B,IAAA;EACF,CAAA;EAEAC,OAAA,GAAUA,MAAA;AACR,IAAA,IAAI,CAAC,oBAAoB,EAAA;EAC3B,CAAA;AAEAC,EAAAA,UAAA,GAAaC,QAAA,CAAUC,OAAS,IAAA;AAC9B;AACA,IAAA,MAAMC,UAAA,GAAaC,IAAA,CAAK,IAAI,EAAE,MAAA;MAC5B,IAAI,CAACpB,MAAM,GAAG,IAAA;AAChB,IAAA,CAAA,CAAA;IAEA,IAAI,CAACmB,UAAU,GAAGA,UAAA;AAClB,IAAA,IAAI,CAACE,kBAAkB,GAAG,IAAI,CAAC,WAAW;AAC1C,IAAA,IAAI,CAACC,kBAAkB,GAAG,IAAI,CAAC,WAAW;IAE1CJ,OAAA,CAAQK,gBAAgB,CACtB,YAAA,EACA,IAAI,CAACF,kBAAsB,CAAA;IAG7BH,OAAA,CAAQK,gBAAgB,CACtB,YAAA,EACA,IAAI,CAACD,kBAAsB,CAAA;AAG7B,IAAA,OAAO,MAAA;MACLJ,OAAA,CAAQM,mBAAmB,CACzB,YAAA,EACA,IAAI,CAACH,kBAAsB,CAAA;MAG7BH,OAAA,CAAQM,mBAAmB,CACzB,YAAA,EACA,IAAI,CAACF,kBAAsB,CAAA;AAG7B;AACAG,MAAAA,MAAA,CAAO,IAAI,CAACN,UAAU,CAAA;AAEtB,MAAA,IAAI,CAAC,oBAAoB,EAAA;IAC3B,CAAA;AACF,EAAA,CAAA,CAAA;AAEA,EAAA;IAAAO,oBAAA,CAAAC,kBAAA,CAAA,udAAA,EAuBA;MAAAC,UAAA,EAAA,IAAA;AAAAC,MAAAA,KAAA,EAAAA,OAAA;AAAAC,QAAAA;AAAA,OAAA;KAAU,CAAA,EAAV,IAAW,CAAA;AAAD;AACZ;;;;"}