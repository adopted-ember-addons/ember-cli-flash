{"version":3,"file":"object.js","sources":["../../src/flash/object.js"],"sourcesContent":["import { cancel, later } from '@ember/runloop';\nimport { isTesting, macroCondition } from '@embroider/macros';\nimport { tracked } from '@glimmer/tracking';\nimport { guidFor } from '@ember/object/internals';\nimport { destroy, isDestroyed, registerDestructor } from '@ember/destroyable';\n\n// Disable timeout by default when running tests\nconst defaultDisableTimeout = macroCondition(isTesting()) ? true : false;\n\nexport default class FlashObject {\n  exitTimer = null;\n  @tracked exiting = false;\n  @tracked message = '';\n  isExitable = true;\n  initializedTime = null;\n\n  // testHelperDisableTimeout â€“ Set by `disableTimeout` and `enableTimeout` in test-support.js\n\n  get _disableTimeout() {\n    return this.testHelperDisableTimeout ?? defaultDisableTimeout;\n  }\n\n  get _guid() {\n    return guidFor(this.message?.toString());\n  }\n\n  constructor(messageOptions) {\n    for (const [key, value] of Object.entries(messageOptions)) {\n      this[key] = value;\n    }\n\n    registerDestructor(this, () => {\n      this.onDestroy?.();\n\n      this._cancelTimer();\n      this._cancelTimer('exitTaskInstance');\n    });\n\n    if (this._disableTimeout || this.sticky) {\n      return;\n    }\n    this.timerTask();\n    this._setInitializedTime();\n  }\n\n  destroyMessage() {\n    this._cancelTimer();\n    if (this.exitTaskInstance) {\n      cancel(this.exitTaskInstance);\n      this._teardown();\n    } else {\n      this.exitTimerTask();\n    }\n  }\n\n  exitMessage() {\n    if (!this.isExitable) {\n      return;\n    }\n    this.exitTimerTask();\n    this.onDidExitMessage?.();\n  }\n  preventExit() {\n    this.isExitable = false;\n  }\n\n  allowExit() {\n    this.isExitable = true;\n    this._checkIfShouldExit();\n  }\n\n  timerTask() {\n    if (!this.timeout) {\n      return;\n    }\n    const timerTaskInstance = later(() => {\n      this.exitMessage();\n    }, this.timeout);\n    this.timerTaskInstance = timerTaskInstance;\n  }\n\n  exitTimerTask() {\n    if (isDestroyed(this)) {\n      return;\n    }\n    this.exiting = true;\n    if (this.extendedTimeout) {\n      let exitTaskInstance = later(() => {\n        this._teardown();\n      }, this.extendedTimeout);\n      this.exitTaskInstance = exitTaskInstance;\n    } else {\n      this._teardown();\n    }\n  }\n\n  _setInitializedTime() {\n    let currentTime = new Date().getTime();\n    this.initializedTime = currentTime;\n\n    return this.initializedTime;\n  }\n\n  _getElapsedTime() {\n    let currentTime = new Date().getTime();\n\n    return currentTime - this.initializedTime;\n  }\n\n  _cancelTimer(taskName = 'timerTaskInstance') {\n    if (this[taskName]) {\n      cancel(this[taskName]);\n    }\n  }\n\n  _checkIfShouldExit() {\n    if (this._getElapsedTime() >= this.timeout && !this.sticky) {\n      this._cancelTimer();\n      this.exitMessage();\n    }\n  }\n\n  _teardown() {\n    if (this.flashService?.queue) {\n      this.flashService.queue = this.flashService.queue.filter(\n        (flash) => flash !== this,\n      );\n    }\n    destroy(this);\n    this.onDidDestroyMessage?.();\n  }\n}\n"],"names":["defaultDisableTimeout","macroCondition","isTesting","FlashObject","_class","_disableTimeout","testHelperDisableTimeout","_guid","guidFor","message","toString","constructor","messageOptions","_defineProperty","_initializerDefineProperty","_descriptor","_descriptor2","key","value","Object","entries","registerDestructor","onDestroy","_cancelTimer","sticky","timerTask","_setInitializedTime","destroyMessage","exitTaskInstance","cancel","_teardown","exitTimerTask","exitMessage","isExitable","onDidExitMessage","preventExit","allowExit","_checkIfShouldExit","timeout","timerTaskInstance","later","isDestroyed","exiting","extendedTimeout","currentTime","Date","getTime","initializedTime","_getElapsedTime","taskName","flashService","queue","filter","flash","destroy","onDidDestroyMessage","_applyDecoratedDescriptor","prototype","tracked","configurable","enumerable","writable","initializer"],"mappings":"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"}